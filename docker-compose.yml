version: '2'
services:
  sqitch:
    build:
      context: .
    working_dir: /src
    volumes:
      - .:/src
    links:
      - db
  api:
    image: begriffs/postgrest:v0.3.2.0
    command: [postgrest, "postgres://postgres@db/mappamundi_dev", --jwt-secret, "${POSTGREST_JWT_SECRET}", -a, postgres, --schema, "1"]
    ports:
      - "3000:3000"
    links:
      - db
    env_file: .env
  db:
    image: postgres:9.5
  web:
    build:
      context: .
      dockerfile: web/Dockerfile-hotreload
    working_dir: /src
    volumes:
      - .:/src
      - /src/node_modules
    links:
      - api
    ports:
      - "5001:2015"
    command: [npm, run-script, start]
